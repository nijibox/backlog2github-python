#!/usr/bin/env python
import os
import ConfigParser
import argparse
from backlog import Project, Api as BacklogApi


CONFIG_DEFAULT_PATH = os.path.join(
    os.path.dirname(__file__),
    'app.ini',
)

config = ConfigParser.ConfigParser()
config.read(CONFIG_DEFAULT_PATH)

parser = argparse.ArgumentParser()
parser.add_argument('key', type=str)
parser.add_argument('--filter', type=str, required=False)

args = parser.parse_args()

backlog = BacklogApi(config.get('Backlog', 'space_id'), config.get('Backlog', 'api_key'))

if '-' in args.key:
    # key is issue
    issue = backlog.get_issue(args.key)
    print(issue['summary'])
    print('========')
    print(issue['description'])
else:
    # key is project
    project = Project.from_api(args.key, backlog)
    issues = project.get_issues()
    for issue in issues:
        print(u'{}: {}'.format(issue['issueKey'], issue['summary']))
        # print('\n')
